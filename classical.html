<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Sticker Customizer - Shopify</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #dbeafe;
            --secondary-color: #f8fafc;
            --accent-color: #3b82f6;
            --gold-accent: #f59e0b;
            --border-color: #e2e8f0;
            --text-color: #1e293b;
            --light-text: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        body {
            background-color: #f1f5f9;
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* Header */
        .app-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1rem;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .app-header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .app-logo i {
            font-size: 1.5rem;
        }
        
        .app-logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .app-actions {
            display: flex;
            gap: 1rem;
        }
        
        .app-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .app-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }
        
        /* Progress Indicator */
        .progress-indicator {
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            background: white;
            box-shadow: var(--shadow-sm);
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
        }
        
        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 1rem;
            left: 50%;
            width: 100%;
            height: 2px;
            background: var(--border-color);
            z-index: 0;
        }
        
        .progress-step.active:not(:last-child)::after {
            background: var(--primary-color);
        }
        
        .progress-step-circle {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
            z-index: 1;
            transition: var(--transition);
        }
        
        .progress-step.active .progress-step-circle {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .progress-step.completed .progress-step-circle {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }
        
        .progress-step-label {
            font-size: 0.75rem;
            text-align: center;
            color: var(--light-text);
            font-weight: 500;
        }
        
        .progress-step.active .progress-step-label {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .progress-step.completed .progress-step-label {
            color: var(--success-color);
        }
        
        /* Main Container */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 1rem;
            min-height: calc(100vh - 180px);
        }
        
        /* Controls Panel */
        .controls-panel {
            background: white;
            border-radius: 1rem;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: sticky;
            top: calc(100px + 4rem);
            height: calc(100vh - 180px);
        }
        
        .controls-tabs {
            display: flex;
            background: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        
        .controls-tab {
            flex: 1;
            padding: 1rem 0.5rem;
            text-align: center;
            font-weight: 500;
            color: var(--light-text);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-size: 0.875rem;
        }
        
        .controls-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: white;
        }
        
        .controls-tab i {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 1rem;
        }
        
        .controls-content {
            padding: 1rem;
            overflow-y: auto;
            flex: 1;
            overflow-x: hidden;
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) transparent;
        }
        
        .controls-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .controls-content::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .controls-content::-webkit-scrollbar-thumb {
            background-color: var(--border-color);
            border-radius: 3px;
        }
        
        .controls-content::-webkit-scrollbar-thumb:hover {
            background-color: var(--light-text);
        }
        
        .control-section {
            margin-bottom: 1.5rem;
        }
        
        .control-section:last-child {
            margin-bottom: 0;
        }
        
        .control-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .control-section-title i {
            color: var(--primary-color);
            font-size: 0.875rem;
        }
        
        .help-tooltip {
            position: relative;
            display: inline-block;
            margin-left: 0.25rem;
            color: var(--light-text);
            cursor: help;
        }
        
        .help-tooltip i {
            font-size: 0.75rem;
        }
        
        .help-tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--text-color);
            color: white;
            text-align: center;
            border-radius: 0.5rem;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            line-height: 1.4;
        }
        
        .help-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Hidden utility class */
        .hidden {
            display: none !important;
        }
        
        /* Logo Upload */
        .logo-upload-container {
            border: 2px dashed var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--secondary-color);
            position: relative;
        }
        
        .logo-upload-container:hover {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }
        
        .logo-upload-container.dragover {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }
        
        .logo-upload-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .logo-upload-text {
            font-weight: 500;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }
        
        .logo-upload-subtext {
            font-size: 0.75rem;
            color: var(--light-text);
        }
        
        .logo-preview {
            margin-top: 0.75rem;
            display: none;
        }
        
        .logo-preview-img {
            max-width: 100%;
            max-height: 100px;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-md);
        }
        
        .logo-preview-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
        }
        
        .logo-preview-name {
            font-size: 0.75rem;
            color: var(--light-text);
            font-weight: 500;
            word-break: break-all;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding-right: 0.5rem;
        }
        
        .logo-remove-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .logo-remove-btn:hover {
            background: #dc2626;
        }
        
        /* Outline Controls */
        .outline-toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: var(--secondary-color);
            border-radius: 0.5rem;
        }
        
        .outline-toggle-label {
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: var(--transition);
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        .outline-controls {
            padding: 0.75rem;
            background: var(--secondary-color);
            border-radius: 0.5rem;
        }
        
        .outline-controls.hidden {
            display: none;
        }
        
        .slider-control {
            margin-bottom: 0.75rem;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .slider-value {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }
        
        .color-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .color-picker {
            width: 48px;
            height: 36px;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            flex-shrink: 0;
            background: none;
            padding: 0;
            transition: var(--transition);
        }
        
        .color-picker:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }
        
        .color-picker::-webkit-color-swatch-wrapper {
            padding: 0;
            border: none;
            border-radius: 0.25rem;
        }
        
        .color-picker::-webkit-color-swatch {
            border: none;
            border-radius: 0.25rem;
        }
        
        .color-picker::-moz-color-swatch {
            border: none;
            border-radius: 0.25rem;
        }
        
        /* Mobile optimizations for color picker */
        @media (max-width: 575px) {
            .color-picker {
                width: 44px;
                height: 32px;
            }
        }
        
        @media (max-width: 375px) {
            .color-picker {
                width: 40px;
                height: 30px;
            }
        }
        
        .color-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
        }
        

        .checkbox-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            background: white;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
        }
        
        .checkbox-control input {
            margin: 0;
        }
        
        .checkbox-label {
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        /* Grid Controls */
        .grid-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .grid-control {
            padding: 0.75rem;
            background: var(--secondary-color);
            border-radius: 0.5rem;
        }
        
        .grid-control-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .grid-control-inputs {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .grid-control-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.75rem;
        }
        
        .grid-control-btn:hover {
            background: var(--primary-dark);
        }
        
        .grid-control-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }
        
        .grid-control-value {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
            font-size: 1rem;
        }
        
        /* Board and Sticker Size Controls */
        .size-controls {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }
        
        .size-control {
            flex: 1;
            padding: 0.75rem;
            background: var(--secondary-color);
            border-radius: 0.5rem;
        }
        
        .size-control-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .size-control-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background: white;
        }
        
        .size-control-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }
        
        .number-input-container {
            display: flex;
            align-items: center;
        }
        
        .number-input-btn {
            width: 28px;
            height: 28px;
            border-radius: 0.25rem;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.75rem;
        }
        
        .number-input-btn:hover {
            background: var(--secondary-color);
        }
        
        .number-input-btn:disabled {
            background: #f1f5f9;
            color: #cbd5e1;
            cursor: not-allowed;
        }
        
        .number-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0;
            font-size: 0.875rem;
            text-align: center;
            border-left: none;
            border-right: none;
        }
        
        .number-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .number-input-container .number-input-btn:first-child {
            border-radius: 0.25rem 0 0 0.25rem;
        }
        
        .number-input-container .number-input-btn:last-child {
            border-radius: 0 0.25rem 0.25rem 0;
        }
        
        /* Smart Suggestions */
        .smart-suggestions {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: var(--primary-light);
            border-radius: 0.5rem;
            border-left: 3px solid var(--primary-color);
        }
        
        .smart-suggestions-title {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .smart-suggestion-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem;
            background: white;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .smart-suggestion-item:hover {
            background: var(--secondary-color);
        }
        
        .smart-suggestion-item:last-child {
            margin-bottom: 0;
        }
        
        .smart-suggestion-text {
            font-size: 0.875rem;
        }
        
        .smart-suggestion-apply {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .smart-suggestion-apply:hover {
            background: var(--primary-dark);
        }
        
        /* Preview Panel */
        .preview-panel {
            background: white;
            border-radius: 1rem;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .preview-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .preview-title {
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .preview-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .preview-action-btn {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-color);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .preview-action-btn:hover {
            background: var(--secondary-color);
        }
        
        .preview-action-btn.primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .preview-action-btn.primary:hover {
            background: var(--primary-dark);
        }
        
        .preview-content {
            padding: 1rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .preview-board-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--secondary-color);
            border-radius: 0.75rem;
            padding: 1rem;
            position: relative;
            overflow: auto;
            min-height: 250px;
        }
        
        .preview-board {
            background: white;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .preview-board-label {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
            z-index: 10;
        }
        
        .canvas-container {
            background-image: 
                linear-gradient(45deg, #ccc 25%, transparent 25%), 
                linear-gradient(-45deg, #ccc 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #ccc 75%), 
                linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: #fff;
            border-radius: 0.5rem;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        #stickerCanvas {
            object-fit: contain;
            display: block;
            transition: var(--transition);
        }
        
        .preview-specs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .preview-spec {
            background: var(--secondary-color);
            padding: 0.75rem;
            border-radius: 0.5rem;
            text-align: center;
        }
        
        .preview-spec-title {
            font-size: 0.75rem;
            color: var(--light-text);
            margin-bottom: 0.25rem;
        }
        
        .preview-spec-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        /* Confirmation Section */
        .confirmation-section {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            background: var(--secondary-color);
        }
        
        .confirmation-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .confirmation-text {
            color: var(--light-text);
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
        }
        
        .confirmation-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .confirmation-btn {
            flex: 1;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .confirmation-btn.primary {
            background: var(--primary-color);
            color: white;
            border: none;
        }
        
        .confirmation-btn.primary:hover {
            background: var(--primary-dark);
        }
        
        .confirmation-btn.secondary {
            background: white;
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        
        .confirmation-btn.secondary:hover {
            background: var(--secondary-color);
        }
        
        .confirmation-message {
            display: none;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
            text-align: center;
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .confirmation-message.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .confirmation-message.help {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        /* Mobile Menu Overlay */
        .controls-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 150;
            display: none;
        }
        
        /* Notification Toast */
        .notification-toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-lg);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }
        
        .notification-toast.show {
            transform: translateX(0);
        }
        
        .notification-toast-icon {
            font-size: 1.25rem;
        }
        
        .notification-toast.success .notification-toast-icon {
            color: var(--success-color);
        }
        
        .notification-toast.error .notification-toast-icon {
            color: var(--danger-color);
        }
        
        .notification-toast.info .notification-toast-icon {
            color: var(--primary-color);
        }
        
        .notification-toast-content {
            flex: 1;
        }
        
        .notification-toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .notification-toast-message {
            font-size: 0.875rem;
            color: var(--light-text);
        }
        
        .notification-toast-close {
            background: none;
            border: none;
            color: var(--light-text);
            cursor: pointer;
            font-size: 1rem;
        }
        
        /* Enhanced Responsive Design */
        
        /* Large Desktop (1400px+) */
        @media (min-width: 1400px) {
            .app-container {
                max-width: 1600px;
                grid-template-columns: 400px 1fr;
            }
            
            .controls-panel {
                width: 400px;
            }
        }
        
        /* Standard Desktop (1200px - 1399px) */
        @media (min-width: 1200px) and (max-width: 1399px) {
            .app-container {
                grid-template-columns: 380px 1fr;
            }
            
            .controls-panel {
                width: 380px;
            }
        }
        
        /* Large Laptop (1024px - 1199px) */
        @media (min-width: 1024px) and (max-width: 1199px) {
            .app-container {
                grid-template-columns: 320px 1fr;
                padding: 0.75rem;
            }
            
            .controls-panel {
                width: 320px;
                height: calc(100vh - 160px);
                top: calc(100px + 3rem);
            }
            
            .preview-board-container {
                padding: 0.75rem;
            }
        }
        
        /* Small Laptop / Large Tablet (768px - 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .app-container {
                grid-template-columns: 280px 1fr;
                padding: 0.5rem;
                gap: 0.75rem;
            }
            
            .controls-panel {
                width: 280px;
                height: calc(100vh - 140px);
                top: calc(100px + 2.5rem);
            }
            
            .app-header-content {
                padding: 0 0.75rem;
            }
            
            .app-logo h1 {
                font-size: 1.25rem;
            }
            
            .app-actions {
                gap: 0.75rem;
            }
            
            .preview-specs {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .size-controls {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
        
        /* Tablet (576px - 767px) */
        @media (min-width: 576px) and (max-width: 767px) {
            .app-header-content {
                padding: 0 0.5rem;
            }
            
            .app-logo h1 {
                font-size: 1.125rem;
            }
            
            .app-actions {
                gap: 0.5rem;
            }
            
            .app-action-btn {
                padding: 0.375rem 0.75rem;
                font-size: 0.875rem;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .app-container {
                grid-template-columns: 1fr;
                padding: 0.5rem;
                gap: 0.5rem;
            }
            
            .controls-panel {
                position: fixed;
                top: 0;
                left: -100%;
                width: 80%;
                max-width: 320px;
                height: 100vh;
                z-index: 200;
                transition: left 0.3s ease;
                border-radius: 0;
                max-height: 100vh;
            }
            
            .controls-panel.open {
                left: 0;
            }
            
            .controls-panel-overlay {
                display: block;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .controls-panel-overlay.show {
                opacity: 1;
                visibility: visible;
            }
            
            .preview-specs {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .confirmation-actions {
                flex-direction: column;
            }
            
            .preview-board-container {
                min-height: 220px;
                padding: 0.75rem;
            }
            
            .size-controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .progress-indicator {
                padding: 0.75rem 0.5rem;
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .progress-step {
                min-width: calc(25% - 0.375rem);
            }
            
            .progress-step-label {
                font-size: 0.7rem;
            }
        }
        
        /* Mobile (up to 575px) */
        @media (max-width: 575px) {
            .app-header {
                padding: 0.75rem 0.5rem;
            }
            
            .app-header-content {
                padding: 0 0.25rem;
            }
            
            .app-logo {
                gap: 0.5rem;
            }
            
            .app-logo h1 {
                font-size: 1rem;
            }
            
            .app-logo i {
                font-size: 1.25rem;
            }
            
            .app-actions {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: block;
                padding: 0.375rem;
                font-size: 1.25rem;
            }
            
            .app-container {
                padding: 0.25rem;
                gap: 0.25rem;
            }
            
            .controls-panel {
                position: fixed;
                top: 0;
                left: -100%;
                width: 90%;
                max-width: 300px;
                height: 100vh;
                z-index: 200;
                transition: left 0.3s ease;
                border-radius: 0;
                max-height: 100vh;
            }
            
            .controls-panel.open {
                left: 0;
            }
            
            .controls-panel-overlay {
                display: block;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .controls-panel-overlay.show {
                opacity: 1;
                visibility: visible;
            }
            
            .preview-header {
                padding: 0.75rem 0.5rem;
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            
            .preview-title {
                font-size: 1rem;
                text-align: center;
            }
            
            .preview-actions {
                justify-content: center;
                gap: 0.5rem;
            }
            
            .preview-action-btn {
                flex: 1;
                max-width: 120px;
                justify-content: center;
            }
            
            .preview-content {
                padding: 0.5rem;
            }
            
            .preview-board-container {
                padding: 0.5rem;
                min-height: 200px;
            }
            
            .confirmation-section {
                padding: 0.75rem 0.5rem;
            }
            
            .confirmation-title {
                font-size: 0.9rem;
            }
            
            .confirmation-text {
                font-size: 0.8rem;
            }
            
            .preview-specs {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .preview-spec {
                padding: 0.5rem;
            }
            
            .preview-spec-title {
                font-size: 0.7rem;
            }
            
            .preview-spec-value {
                font-size: 0.8rem;
            }
            
            .controls-tab {
                padding: 0.75rem 0.25rem;
                font-size: 0.7rem;
            }
            
            .controls-tab i {
                font-size: 0.875rem;
                margin-bottom: 0.125rem;
            }
            
            .controls-content {
                padding: 0.75rem;
            }
            
            .control-section {
                margin-bottom: 1rem;
            }
            
            .control-section-title {
                font-size: 0.8rem;
                margin-bottom: 0.5rem;
            }
            
            .control-section-title i {
                font-size: 0.8rem;
            }
            
            .logo-upload-container {
                padding: 0.75rem 0.5rem;
            }
            
            .logo-upload-icon {
                font-size: 1.25rem;
                margin-bottom: 0.375rem;
            }
            
            .logo-upload-text {
                font-size: 0.75rem;
                margin-bottom: 0.125rem;
            }
            
            .logo-upload-subtext {
                font-size: 0.625rem;
            }
            
            .outline-toggle-container {
                padding: 0.5rem;
                margin-bottom: 0.5rem;
            }
            
            .outline-controls {
                padding: 0.5rem;
            }
            
            .slider-control {
                margin-bottom: 0.5rem;
            }
            
            .slider-label {
                font-size: 0.8rem;
                margin-bottom: 0.375rem;
            }
            
            .color-control {
                margin-bottom: 0.5rem;
            }
            
            .size-controls {
                flex-direction: column;
                gap: 0.5rem;
                margin-top: 0.5rem;
            }
            
            .size-control {
                padding: 0.5rem;
            }
            
            .size-control-label {
                font-size: 0.8rem;
                margin-bottom: 0.375rem;
            }
            
            .number-input-container {
                gap: 0.25rem;
            }
            
            .number-input-btn {
                width: 32px;
                height: 32px;
                font-size: 0.75rem;
            }
            
            .number-input {
                padding: 0.375rem;
                font-size: 0.8rem;
            }
            
            .smart-suggestions {
                margin-top: 0.5rem;
                padding: 0.5rem;
            }
            
            .smart-suggestions-title {
                font-size: 0.8rem;
                margin-bottom: 0.375rem;
            }
            
            .smart-suggestion-item {
                padding: 0.375rem;
                margin-bottom: 0.375rem;
            }
            
            .smart-suggestion-text {
                font-size: 0.75rem;
            }
            
            .progress-indicator {
                padding: 0.5rem 0.25rem;
                flex-wrap: wrap;
                gap: 0.25rem;
            }
            
            .progress-step {
                min-width: calc(25% - 0.1875rem);
            }
            
            .progress-step-circle {
                width: 1.5rem;
                height: 1.5rem;
                font-size: 0.7rem;
                margin-bottom: 0.25rem;
            }
            
            .progress-step-label {
                font-size: 0.65rem;
                line-height: 1.2;
            }
            
            .notification-toast {
                bottom: 0.75rem;
                right: 0.75rem;
                left: 0.75rem;
                max-width: none;
                transform: translateY(120%);
            }
            
            .notification-toast.show {
                transform: translateY(0);
            }
        }
        
        /* Extra Small Mobile (up to 375px) */
        @media (max-width: 375px) {
            .app-header {
                padding: 0.5rem 0.25rem;
            }
            
            .app-logo h1 {
                font-size: 0.9rem;
            }
            
            .app-logo i {
                font-size: 1.1rem;
            }
            
            .mobile-menu-toggle {
                font-size: 1.1rem;
                padding: 0.25rem;
            }
            
            .app-container {
                padding: 0.125rem;
                gap: 0.125rem;
            }
            
            .controls-content {
                padding: 0.5rem;
            }
            
            .preview-header {
                padding: 0.5rem 0.25rem;
            }
            
            .preview-title {
                font-size: 0.9rem;
            }
            
            .preview-action-btn {
                padding: 0.375rem 0.5rem;
                font-size: 0.75rem;
            }
            
            .preview-content {
                padding: 0.375rem;
            }
            
            .preview-board-container {
                padding: 0.375rem;
                min-height: 180px;
            }
            
            .confirmation-section {
                padding: 0.5rem 0.25rem;
            }
            
            .confirmation-title {
                font-size: 0.85rem;
            }
            
            .confirmation-text {
                font-size: 0.75rem;
            }
            
            .confirmation-btn {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
        }
        
        /* Height-based adjustments for desktop */
        @media (min-width: 1024px) and (max-height: 800px) {
            .controls-panel {
                height: calc(100vh - 140px);
                top: calc(100px + 2rem);
            }
            
            .controls-content {
                max-height: calc(100vh - 220px);
            }
            
            .app-header {
                padding: 0.75rem 1rem;
            }
            
            .progress-indicator {
                padding: 0.75rem 1rem;
            }
        }
        
        @media (min-width: 1024px) and (min-height: 801px) and (max-height: 1000px) {
            .controls-panel {
                height: calc(100vh - 160px);
                top: calc(100px + 3rem);
            }
            
            .controls-content {
                max-height: calc(100vh - 240px);
            }
        }
        
        @media (min-width: 1024px) and (min-height: 1001px) {
            .controls-panel {
                height: calc(100vh - 180px);
                top: calc(100px + 4rem);
            }
            
            .controls-content {
                max-height: calc(100vh - 280px);
            }
        }
        
        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .controls-tab {
                padding: 1rem 0.5rem;
            }
            
            .app-action-btn,
            .preview-action-btn,
            .confirmation-btn {
                min-height: 44px;
                touch-action: manipulation;
            }
            
            .number-input-btn {
                min-width: 44px;
                min-height: 44px;
            }
            
            .slider {
                height: 8px;
            }
            
            .slider::-webkit-slider-thumb {
                width: 24px;
                height: 24px;
            }
        }
        
        /* High DPI display optimizations */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .preview-board {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            
            .controls-panel {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
        }
    </style>
</head>
<body>
    <!-- App Header -->
    <header class="app-header">
        <div class="app-header-content">
            <div class="app-logo">
                <i class="fas fa-tags"></i>
                <h1>Sticker Customizer</h1>
            </div>
            <div class="app-actions">
                <button class="app-action-btn" id="saveDesignBtn">
                    <i class="fas fa-save"></i>
                    <span>Save Design</span>
                </button>
                <button class="app-action-btn" id="shareDesignBtn">
                    <i class="fas fa-share-alt"></i>
                    <span>Share</span>
                </button>
            </div>
            <button class="mobile-menu-toggle" id="mobileMenuToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>
    
    <!-- Progress Indicator -->
    <div class="progress-indicator">
        <div class="progress-step active" id="step1">
            <div class="progress-step-circle">
                <i class="fas fa-image"></i>
            </div>
            <div class="progress-step-label">Logo</div>
        </div>
        <div class="progress-step" id="step2">
            <div class="progress-step-circle">
                <i class="fas fa-border-style"></i>
            </div>
            <div class="progress-step-label">Outline</div>
        </div>
        <div class="progress-step" id="step3">
            <div class="progress-step-circle">
                <i class="fas fa-th"></i>
            </div>
            <div class="progress-step-label">Layout</div>
        </div>
        <div class="progress-step" id="step4">
            <div class="progress-step-circle">
                <i class="fas fa-check"></i>
            </div>
            <div class="progress-step-label">Confirm</div>
        </div>
    </div>
    
    <!-- Main App Container -->
    <div class="app-container">
        <!-- Controls Panel -->
        <aside class="controls-panel" id="controlsPanel">
            <div class="controls-tabs">
                <div class="controls-tab active" data-tab="design">
                    <i class="fas fa-palette"></i>
                    <span>Design</span>
                </div>
            </div>
            
            <div class="controls-content">
                <!-- Design Tab -->
                <div class="tab-content" id="designTab">
                    <!-- Logo Upload Section -->
                    <div class="control-section" id="logoSection">
                        <div class="control-section-title">
                            <i class="fas fa-image"></i>
                            Logo
                            <div class="help-tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltip-text">Upload your logo in PNG or JPG format. Recommended size: 500x500px or larger for best quality.</span>
                            </div>
                        </div>
                        <div class="logo-upload-container" id="logoUploadContainer">
                            <div class="logo-upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="logo-upload-text">Upload Logo</div>
                            <div class="logo-upload-subtext">Click to upload or drag and drop</div>
                            <input type="file" id="logoFileInput" accept="image/*" style="display: none;">
                        </div>
                        <div class="logo-preview" id="logoPreview">
                            <img class="logo-preview-img" id="logoPreviewImg" src="" alt="Logo Preview">
                            <div class="logo-preview-actions">
                                <div class="logo-preview-name" id="logoPreviewName"></div>
                                <button class="logo-remove-btn" id="logoRemoveBtn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Color Controls -->
                    <div class="control-section" id="colorSection">
                        <div class="control-section-title">
                            <i class="fas fa-palette"></i>
                            Colors
                            <div class="help-tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltip-text">Choose outline colors for your stickers. Use the palette or enter a custom hex color.</span>
                            </div>
                        </div>
                        
                        <div class="color-control">
                            <input type="color" class="color-picker" id="outlineColorPicker" value="#000000">
                            <input type="text" class="color-input" id="outlineColorHex" value="#000000" maxlength="7">
                        </div>
                    </div>

                    <!-- Size Controls -->
                    <div class="control-section" id="sizeSection">
                        <div class="control-section-title">
                            <i class="fas fa-ruler-combined"></i>
                            Size Settings
                            <div class="help-tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltip-text">Select your board size and sticker diameter. Layout will automatically optimize for perfect fit.</span>
                            </div>
                        </div>
                        
                        <div class="size-controls">
                            <div class="size-control">
                                <div class="size-control-label">
                                    <i class="fas fa-expand-arrows-alt"></i>
                                    Board Size (cm)
                                </div>
                                <select class="size-control-input" id="boardSizeSelect">
                                    <option value="10x15">10  15</option>
                                    <option value="15x20">15  20</option>
                                    <option value="20x30">20  30</option>
                                    <option value="30x40">30  40</option>
                                    <option value="40x50">40  50</option>
                                    <option value="50x70">50  70</option>
                                </select>
                            </div>
                            
                            <div class="size-control">
                                <div class="size-control-label">
                                    <i class="fas fa-circle"></i>
                                    Sticker Diameter (cm)
                                </div>
                                <div class="number-input-container">
                                    <button class="number-input-btn" id="diameterDecrease">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" class="number-input" id="diameterInput" value="5" min="1" max="20" step="0.5">
                                    <button class="number-input-btn" id="diameterIncrease">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Outline Controls -->
                    <div class="control-section" id="outlineSection">
                        <div class="control-section-title">
                            <i class="fas fa-border-style"></i>
                            Outline Settings
                            <div class="help-tooltip">
                                <i class="fas fa-question-circle"></i>
                                <span class="tooltip-text">Configure outline width and smoothing for your stickers.</span>
                            </div>
                        </div>
                        
                        <div class="outline-toggle-container">
                            <div class="outline-toggle-label">Enable Outline</div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="outlineToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="outline-controls" id="outlineControls">
                            <div class="slider-control">
                                <div class="slider-label">
                                    <span>Outline Width</span>
                                    <span class="slider-value" id="outlineWidthValue">10px</span>
                                </div>
                                <input type="range" min="0" max="30" value="10" class="slider" id="outlineWidth">
                            </div>
                            
                            <div class="checkbox-control">
                                <input type="checkbox" id="smoothingToggle" checked>
                                <label class="checkbox-label" for="smoothingToggle">Enable Smooth Edges</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Preview Panel -->
        <main class="preview-panel">
            <div class="preview-header">
                <h2 class="preview-title">Preview</h2>
                <div class="preview-actions">
                    <button class="preview-action-btn" id="resetBtn">
                        <i class="fas fa-undo"></i>
                        <span>Reset</span>
                    </button>
                    <button class="preview-action-btn primary" id="downloadBtn">
                        <i class="fas fa-download"></i>
                        <span>Download</span>
                    </button>
                </div>
            </div>
            
            <div class="preview-content">
                <div class="preview-board-container">
                    <div class="preview-board" id="previewBoard">
                        <div class="preview-board-label" id="boardLabel">Board 10  15 cm</div>
                        <div class="canvas-container" id="canvasContainer">
                            <canvas id="stickerCanvas"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="preview-specs">
                    <div class="preview-spec">
                        <div class="preview-spec-title">Board Size</div>
                        <div class="preview-spec-value" id="boardSizeValue">10  15 cm</div>
                    </div>
                    <div class="preview-spec">
                        <div class="preview-spec-title">Total Stickers</div>
                        <div class="preview-spec-value" id="totalStickersValue">4</div>
                    </div>
                    <div class="preview-spec">
                        <div class="preview-spec-title">Sticker Diameter</div>
                        <div class="preview-spec-value" id="stickerDiameterValue">5 cm</div>
                    </div>
                    <div class="preview-spec">
                        <div class="preview-spec-title">Space Used</div>
                        <div class="preview-spec-value" id="spaceUsedValue">75%</div>
                    </div>
                </div>
            </div>
            
            <div class="confirmation-section">
                <h3 class="confirmation-title">Do these labels suit you?</h3>
                <p class="confirmation-text">Check preview and confirm if design meets your expectations.</p>
                
                <div class="confirmation-actions">
                    <button class="confirmation-btn primary" id="confirmYesBtn">
                        <i class="fas fa-check-circle"></i>
                        <span>Yes, it's perfect!</span>
                    </button>
                    <button class="confirmation-btn secondary" id="confirmHelpBtn">
                        <i class="fas fa-question-circle"></i>
                        <span>I need help</span>
                    </button>
                </div>
                
                <div class="confirmation-message success" id="successMessage">
                    <i class="fas fa-check"></i> Thank you! Your design has been confirmed and added to your cart.
                </div>
                
                <div class="confirmation-message help" id="helpMessage">
                    <i class="fas fa-headset"></i> Our support team will contact you shortly to assist with your design.
                </div>
            </div>
        </main>
    </div>
    
    <!-- Mobile Menu Overlay -->
    <div class="controls-panel-overlay" id="controlsPanelOverlay"></div>
    
    <!-- Notification Toast -->
    <div class="notification-toast" id="notificationToast">
        <div class="notification-toast-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="notification-toast-content">
            <div class="notification-toast-title" id="notificationTitle">Success</div>
            <div class="notification-toast-message" id="notificationMessage">Action completed successfully</div>
        </div>
        <button class="notification-toast-close" id="notificationClose">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const controlsPanel = document.getElementById('controlsPanel');
            const controlsPanelOverlay = document.getElementById('controlsPanelOverlay');
            
            // Tab Elements
            const designTab = document.getElementById('designTab');
            
            // Progress Steps
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const step4 = document.getElementById('step4');
            
            // Logo Upload Elements
            const logoSection = document.getElementById('logoSection');
            const logoUploadContainer = document.getElementById('logoUploadContainer');
            const logoFileInput = document.getElementById('logoFileInput');
            const logoPreview = document.getElementById('logoPreview');
            const logoPreviewImg = document.getElementById('logoPreviewImg');
            const logoPreviewName = document.getElementById('logoPreviewName');
            const logoRemoveBtn = document.getElementById('logoRemoveBtn');
            
            // Outline Elements
            const outlineSection = document.getElementById('outlineSection');
            const outlineToggle = document.getElementById('outlineToggle');
            const outlineControls = document.getElementById('outlineControls');
            const outlineWidth = document.getElementById('outlineWidth');
            const outlineWidthValue = document.getElementById('outlineWidthValue');
            const outlineColorPicker = document.getElementById('outlineColorPicker');
            const outlineColorHex = document.getElementById('outlineColorHex');
            const smoothingToggle = document.getElementById('smoothingToggle');
            
            // Canvas and Container Elements
            const canvas = document.getElementById('stickerCanvas');
            const ctx = canvas.getContext('2d');
            const previewBoard = document.getElementById('previewBoard');
            const canvasContainer = document.getElementById('canvasContainer');
            
            // Size Elements
            const sizeSection = document.getElementById('sizeSection');
            const boardSizeSelect = document.getElementById('boardSizeSelect');
            const diameterDecrease = document.getElementById('diameterDecrease');
            const diameterIncrease = document.getElementById('diameterIncrease');
            const diameterInput = document.getElementById('diameterInput');
            
            // Preview Elements
            const boardLabel = document.getElementById('boardLabel');
            const boardSizeValue = document.getElementById('boardSizeValue');
            const totalStickersValue = document.getElementById('totalStickersValue');
            const stickerDiameterValue = document.getElementById('stickerDiameterValue');
            const spaceUsedValue = document.getElementById('spaceUsedValue');
            
            // Action Buttons
            const resetBtn = document.getElementById('resetBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const saveDesignBtn = document.getElementById('saveDesignBtn');
            const shareDesignBtn = document.getElementById('shareDesignBtn');
            const confirmYesBtn = document.getElementById('confirmYesBtn');
            const confirmHelpBtn = document.getElementById('confirmHelpBtn');
            const successMessage = document.getElementById('successMessage');
            const helpMessage = document.getElementById('helpMessage');
            
            // Notification Toast
            const notificationToast = document.getElementById('notificationToast');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            const notificationClose = document.getElementById('notificationClose');
            
            // Default logo
            const defaultLogo = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%232563eb'/%3E%3Ctext x='50' y='60' font-family='Inter, sans-serif' font-size='24' text-anchor='middle' fill='white'%3ELogo%3C/text%3E%3C/svg%3E";
            

            // Board size options mapping
            const boardSizeOptions = {
                '10x15': { width: 10, height: 15 },
                '15x20': { width: 15, height: 20 },
                '20x30': { width: 20, height: 30 },
                '30x40': { width: 30, height: 40 },
                '40x50': { width: 40, height: 50 },
                '50x70': { width: 50, height: 70 }
            };
            
            // App State
            const appState = {
                logoUrl: defaultLogo,
                originalImage: null,
                boardSize: { width: 10, height: 15 }, // in cm
                stickerDiameter: 5, // in cm
                outlineEnabled: true,
                outline: {
                    width: 10,
                    color: '#000000',
                    smoothing: true
                },
                grid: {
                    horizontal: 2,
                    vertical: 2
                },
                currentStep: 1,
                hasLogo: false,
                hasOutline: true,
                hasLayout: false
            };
            
            // Initialize the app
            function initApp() {
                // Set initial values
                outlineWidth.value = appState.outline.width;
                outlineWidthValue.textContent = `${appState.outline.width}px`;
                outlineToggle.checked = appState.outlineEnabled;
                smoothingToggle.checked = appState.outline.smoothing;
                boardSizeSelect.value = '10x15';
                diameterInput.value = appState.stickerDiameter;
                
                // Set initial color picker value
                outlineColorPicker.value = appState.outline.color;
                outlineColorHex.value = appState.outline.color;
                
                // Show default logo preview
                logoPreviewImg.src = defaultLogo;
                logoPreviewName.textContent = 'Default Logo';
                logoPreview.style.display = 'block';
                
                // Load default logo
                loadDefaultLogo();
                
                // Auto-optimize layout based on current settings
                autoOptimizeLayout();
                
                // Update size display
                updateSizeDisplay();
                
                // Update space used
                updateSpaceUsed();
                
                // Update progress
                updateProgress();
                
                // Initial draw
                draw();
            }
            
            // Load default logo as image
            function loadDefaultLogo() {
                const img = new Image();
                img.onload = function() {
                    appState.originalImage = img;
                    draw();
                };
                img.src = defaultLogo;
            }
            
            // Show notification toast
            function showNotification(title, message, type = 'success') {
                notificationTitle.textContent = title;
                notificationMessage.textContent = message;
                
                // Update icon and class based on type
                const icon = notificationToast.querySelector('.notification-toast-icon i');
                notificationToast.className = 'notification-toast show ' + type;
                
                if (type === 'success') {
                    icon.className = 'fas fa-check-circle';
                } else if (type === 'error') {
                    icon.className = 'fas fa-exclamation-circle';
                } else if (type === 'info') {
                    icon.className = 'fas fa-info-circle';
                }
                
                // Auto hide after 5 seconds
                setTimeout(() => {
                    notificationToast.classList.remove('show');
                }, 5000);
            }
            
            // Update progress indicator
            function updateProgress() {
                // Reset all steps
                step1.classList.remove('active', 'completed');
                step2.classList.remove('active', 'completed');
                step3.classList.remove('active', 'completed');
                step4.classList.remove('active', 'completed');
                
                // Update based on current state
                if (appState.hasLogo) {
                    step1.classList.add('completed');
                    step2.classList.add('active');
                    
                    if (appState.hasOutline) {
                        step2.classList.add('completed');
                        step3.classList.add('active');
                        
                        if (appState.hasLayout) {
                            step3.classList.add('completed');
                            step4.classList.add('active');
                        }
                    }
                } else {
                    step1.classList.add('active');
                }
            }
            
            // Mobile Menu Toggle
            mobileMenuToggle.addEventListener('click', function() {
                controlsPanel.classList.toggle('open');
                controlsPanelOverlay.classList.toggle('show');
                // Prevent body scroll when menu is open
                document.body.style.overflow = controlsPanel.classList.contains('open') ? 'hidden' : '';
            });
            
            controlsPanelOverlay.addEventListener('click', function() {
                controlsPanel.classList.remove('open');
                controlsPanelOverlay.classList.remove('show');
                document.body.style.overflow = '';
            });
            
            // Removed tab switching functionality since all controls are now in Design tab
            
            // Logo Upload with drag and drop
            logoUploadContainer.addEventListener('click', function() {
                logoFileInput.click();
            });
            
            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                logoUploadContainer.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            // Highlight drop area when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                logoUploadContainer.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                logoUploadContainer.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                logoUploadContainer.classList.add('dragover');
            }
            
            function unhighlight() {
                logoUploadContainer.classList.remove('dragover');
            }
            
            // Handle dropped files
            logoUploadContainer.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    handleFiles(files);
                }
            }
            
            logoFileInput.addEventListener('change', function(event) {
                const files = event.target.files;
                if (files.length > 0) {
                    handleFiles(files);
                }
            });
            
            function handleFiles(files) {
                const file = files[0];
                if (file) {
                    if (file.type.match('image.*')) {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            // Update logo URL
                            appState.logoUrl = e.target.result;
                            appState.hasLogo = true;
                            
                            // Show preview
                            logoPreviewImg.src = e.target.result;
                            logoPreviewName.textContent = file.name;
                            logoPreview.style.display = 'block';
                            
                            // Load image for canvas
                            const img = new Image();
                            img.onload = function() {
                                appState.originalImage = img;
                                draw();
                                updateProgress();
                            };
                            img.src = e.target.result;
                            
                            // Show notification
                            showNotification('Logo Uploaded', 'Your logo has been successfully uploaded', 'success');
                        };
                        
                        reader.readAsDataURL(file);
                    } else {
                        showNotification('Upload Error', 'Please select an image file (JPEG, PNG, GIF, etc.)', 'error');
                    }
                }
            }
            
            // Remove logo
            logoRemoveBtn.addEventListener('click', function() {
                // Reset to default logo
                appState.logoUrl = defaultLogo;
                appState.hasLogo = false;
                
                // Update preview
                logoPreviewImg.src = defaultLogo;
                logoPreviewName.textContent = 'Default Logo';
                
                // Load default logo
                loadDefaultLogo();
                
                // Update progress
                updateProgress();
                
                // Show notification
                showNotification('Logo Removed', 'Your logo has been removed', 'info');
            });
            
            // Outline Toggle
            outlineToggle.addEventListener('change', function() {
                appState.outlineEnabled = this.checked;
                appState.hasOutline = this.checked;
                outlineControls.classList.toggle('hidden', !this.checked);
                
                draw();
                updateProgress();
                
                // Show notification
                const status = this.checked ? 'enabled' : 'disabled';
                showNotification('Outline Updated', `Outline has been ${status}`, 'info');
            });
            
            // Outline Width
            outlineWidth.addEventListener('input', function() {
                appState.outline.width = parseInt(this.value);
                outlineWidthValue.textContent = `${appState.outline.width}px`;
                draw();
            });
            
            // Outline Color
            outlineColorPicker.addEventListener('input', function() {
                const color = this.value;
                appState.outline.color = color;
                outlineColorHex.value = color;
                draw();
            });
            
            outlineColorHex.addEventListener('input', function() {
                let color = this.value;
                
                // Add # if missing
                if (!color.startsWith('#')) {
                    color = '#' + color;
                }
                
                // Validate hex color
                const hexColorRegex = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;
                if (hexColorRegex.test(color)) {
                    appState.outline.color = color;
                    outlineColorPicker.value = color;
                    draw();
                }
            });
            
            // Smoothing Toggle
            smoothingToggle.addEventListener('change', function() {
                appState.outline.smoothing = this.checked;
                draw();
            });
            
            // Auto-optimize layout function
            function autoOptimizeLayout() {
                // Calculate optimal grid based on board size and sticker diameter
                const boardWidth = appState.boardSize.width;
                const boardHeight = appState.boardSize.height;
                const stickerDiameter = appState.stickerDiameter;
                
                // Calculate how many stickers can fit perfectly
                const horizontalFit = Math.floor(boardWidth / stickerDiameter);
                const verticalFit = Math.floor(boardHeight / stickerDiameter);
                
                // Update grid with perfect fit
                appState.grid.horizontal = Math.min(6, Math.max(1, horizontalFit));
                appState.grid.vertical = Math.min(6, Math.max(1, verticalFit));
                
                // Update display
                updateSpaceUsed();
                draw(); // Redraw with optimized layout
                
                // Mark layout as configured
                appState.hasLayout = true;
                updateProgress();
                
                // Show notification
                showNotification('Layout Auto-Optimized', `Perfect fit: ${appState.grid.horizontal}${appState.grid.vertical} stickers`, 'success');
            }
            
            // Size Controls
            boardSizeSelect.addEventListener('change', function() {
                const selectedSize = this.value;
                appState.boardSize = boardSizeOptions[selectedSize];
                updateSizeDisplay();
                updateSpaceUsed();
                autoOptimizeLayout(); // Automatically optimize layout for new board size
            });
            
            diameterDecrease.addEventListener('click', function() {
                const currentValue = parseFloat(diameterInput.value);
                if (currentValue > 1) {
                    const newValue = Math.max(1, currentValue - 0.5);
                    diameterInput.value = newValue;
                    appState.stickerDiameter = newValue;
                    updateSizeDisplay();
                    updateSpaceUsed();
                    autoOptimizeLayout(); // Automatically optimize layout for new diameter
                }
            });
            
            diameterIncrease.addEventListener('click', function() {
                const currentValue = parseFloat(diameterInput.value);
                if (currentValue < 20) {
                    const newValue = Math.min(20, currentValue + 0.5);
                    diameterInput.value = newValue;
                    appState.stickerDiameter = newValue;
                    updateSizeDisplay();
                    updateSpaceUsed();
                    autoOptimizeLayout(); // Automatically optimize layout for new diameter
                }
            });
            
            diameterInput.addEventListener('input', function() {
                let value = parseFloat(this.value);
                if (isNaN(value)) value = 1;
                value = Math.max(1, Math.min(20, value));
                this.value = value;
                appState.stickerDiameter = value;
                updateSizeDisplay();
                updateSpaceUsed();
                autoOptimizeLayout(); // Automatically optimize layout for new diameter
            });
            
            // Action Buttons
            resetBtn.addEventListener('click', function() {
                // Reset to default values
                appState.logoUrl = defaultLogo;
                appState.originalImage = null;
                appState.boardSize = { width: 10, height: 15 };
                appState.stickerDiameter = 5;
                appState.outlineEnabled = true;
                appState.outline.width = 10;
                appState.outline.color = '#000000';
                appState.outline.smoothing = true;
                appState.grid.horizontal = 2;
                appState.grid.vertical = 2;
                appState.hasLogo = false;
                appState.hasOutline = true;
                appState.hasLayout = false;
                
                // Update UI
                outlineWidth.value = appState.outline.width;
                outlineWidthValue.textContent = `${appState.outline.width}px`;
                outlineToggle.checked = appState.outlineEnabled;
                outlineColorPicker.value = appState.outline.color;
                outlineColorHex.value = appState.outline.color;
                smoothingToggle.checked = appState.outline.smoothing;
                boardSizeSelect.value = '10x15';
                diameterInput.value = appState.stickerDiameter;
                
                // Reset logo
                logoPreviewImg.src = defaultLogo;
                logoPreviewName.textContent = 'Default Logo';
                
                // Load default logo
                loadDefaultLogo();
                
                // Update displays
                updateSizeDisplay();
                updateSpaceUsed();
                updateProgress();
                draw(); // Redraw
                
                // Show notification
                showNotification('Settings Reset', 'All settings have been reset to default', 'info');
            });
            
            // Download button - generate sticker sheet
            downloadBtn.addEventListener('click', function() {
                generateStickerSheet();
            });
            
            // Save Design Button
            saveDesignBtn.addEventListener('click', function() {
                // In a real implementation, this would save the design to user account
                showNotification('Design Saved', 'Your design has been saved to your account', 'success');
            });
            
            // Share Design Button
            shareDesignBtn.addEventListener('click', function() {
                // In a real implementation, this would open share dialog
                showNotification('Share Ready', 'Share options are now available', 'info');
            });
            
            confirmYesBtn.addEventListener('click', function() {
                // Hide other messages
                helpMessage.style.display = 'none';
                
                // Show success message
                successMessage.style.display = 'block';
                
                // In a real Shopify implementation, this would add the item to cart
                console.log('Sticker design confirmed with configuration:', appState);
                
                // Show notification
                showNotification('Order Confirmed', 'Your design has been added to cart', 'success');
                
                // Scroll to confirmation message
                successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
                // Hide message after 5 seconds
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 5000);
            });
            
            confirmHelpBtn.addEventListener('click', function() {
                // Hide other messages
                successMessage.style.display = 'none';
                
                // Show help message
                helpMessage.style.display = 'block';
                
                // In a real implementation, this would trigger a support request
                console.log('Help requested for sticker design');
                
                // Show notification
                showNotification('Support Requested', 'Our team will contact you shortly', 'info');
                
                // Scroll to confirmation message
                helpMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
                // Hide message after 5 seconds
                setTimeout(() => {
                    helpMessage.style.display = 'none';
                }, 5000);
            });
            
            // Close notification
            notificationClose.addEventListener('click', function() {
                notificationToast.classList.remove('show');
            });
            

            // Calculate space used percentage
            function calculateSpaceUsed() {
                const boardArea = appState.boardSize.width * appState.boardSize.height;
                const stickerArea = Math.PI * Math.pow(appState.stickerDiameter / 2, 2);
                const totalStickerArea = stickerArea * appState.grid.horizontal * appState.grid.vertical;
                
                return Math.min(100, Math.round((totalStickerArea / boardArea) * 100));
            }
            
            // Update space used display
            function updateSpaceUsed() {
                const spaceUsed = calculateSpaceUsed();
                spaceUsedValue.textContent = `${spaceUsed}%`;
                totalStickersValue.textContent = appState.grid.horizontal * appState.grid.vertical;
                
                // Update color based on usage
                if (spaceUsed < 50) {
                    spaceUsedValue.style.color = '#ef4444';
                } else if (spaceUsed < 80) {
                    spaceUsedValue.style.color = '#f59e0b';
                } else {
                    spaceUsedValue.style.color = '#10b981';
                }
            }
            
            // Update Size Display
            function updateSizeDisplay() {
                // Update board label
                boardLabel.textContent = `Board ${appState.boardSize.width}  ${appState.boardSize.height} cm`;
                boardSizeValue.textContent = `${appState.boardSize.width}  ${appState.boardSize.height} cm`;
                
                // Update sticker diameter
                stickerDiameterValue.textContent = `${appState.stickerDiameter} cm`;
                
                // Update button states
                diameterDecrease.disabled = appState.stickerDiameter <= 1;
                diameterIncrease.disabled = appState.stickerDiameter >= 20;
            }
            
            // Grid display function-optimization instead
            // Layout is size or diameter changes
            // No manual grid controls needed with the new auto automatically optimized when board removed - using auto-fit system
            
            // Dynamic canvas sizing based on grid layout
            function updateCanvasSize() {
                const cols = appState.grid.horizontal;
                const rows = appState.grid.vertical;
                
                // Base sticker size (will be adjusted for readability)
                const baseStickerSize = 60; // pixels
                const gap = 15; // pixels between stickers
                const padding = 30; // padding around the grid
                
                // Calculate total dimensions
                const totalWidth = cols * baseStickerSize + (cols - 1) * gap + padding * 2;
                const totalHeight = rows * baseStickerSize + (rows - 1) * gap + padding * 2;
                
                // Set canvas size
                canvas.width = totalWidth;
                canvas.height = totalHeight;
                
                // Update container sizes to fit content
                previewBoard.style.width = totalWidth + 'px';
                previewBoard.style.height = totalHeight + 'px';
                canvasContainer.style.width = totalWidth + 'px';
                canvasContainer.style.height = totalHeight + 'px';
                
                // Add smooth transition
                previewBoard.style.transition = 'width 0.3s ease, height 0.3s ease';
                canvasContainer.style.transition = 'width 0.3s ease, height 0.3s ease';
            }
            
            // Main draw function with original resolution support
            function draw() {
                if (!appState.originalImage) return;
                
                // Update canvas size based on grid with original resolution support
                updateCanvasSizeForOriginalResolution();
                
                const width = canvas.width;
                const height = canvas.height;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw a subtle grid background for the board
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, 0, width, height);
                
                const outlineWidth = appState.outlineEnabled ? appState.outline.width : 0;
                const outlineColor = appState.outline.color;
                const smooth = appState.outline.smoothing;
                
                // Calculate grid layout
                const cols = appState.grid.horizontal;
                const rows = appState.grid.vertical;
                
                // Get sticker size from canvas dimensions with original resolution support
                const padding = 30;
                const gap = 15;
                const availableWidth = width - (padding * 2);
                const availableHeight = height - (padding * 2);
                
                // Calculate sticker size based on grid and available space
                const stickerSize = Math.min(
                    (availableWidth - (cols - 1) * gap) / cols,
                    (availableHeight - (rows - 1) * gap) / rows
                );
                
                // Calculate starting position to center the grid
                const totalWidth = cols * stickerSize + (cols - 1) * gap;
                const totalHeight = rows * stickerSize + (rows - 1) * gap;
                const startX = (width - totalWidth) / 2;
                const startY = (height - totalHeight) / 2;
                
                // Draw each sticker in the grid with original resolution support
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < cols; col++) {
                        const stickerX = startX + col * (stickerSize + gap);
                        const stickerY = startY + row * (stickerSize + gap);
                        const centerX = stickerX + stickerSize / 2;
                        const centerY = stickerY + stickerSize / 2;
                        
                        // Create a temporary canvas for this sticker
                        const tempCanvas = document.createElement('canvas');
                        tempCanvas.width = stickerSize;
                        tempCanvas.height = stickerSize;
                        const tempCtx = tempCanvas.getContext('2d');
                        
                        // Clear temp canvas
                        tempCtx.clearRect(0, 0, stickerSize, stickerSize);
                        
                        // Draw sticker background circle
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, stickerSize / 2, 0, 2 * Math.PI);
                        ctx.fillStyle = '#ffffff';
                        ctx.fill();
                        
                        // Add subtle shadow
                        ctx.shadowColor = 'rgba(0, 0, 0, 0.1)';
                        ctx.shadowBlur = 4;
                        ctx.shadowOffsetX = 2;
                        ctx.shadowOffsetY = 2;
                        
                        // Calculate image size with ORIGINAL RESOLUTION SUPPORT
                        const imgW = appState.originalImage.width;
                        const imgH = appState.originalImage.height;
                        
                        // For original resolution, use the full image size or scale to fit sticker
                        const maxImgSize = stickerSize * 0.8; // Use 80% of sticker size for original resolution
                        const imgScale = Math.min(maxImgSize / imgW, maxImgSize / imgH);
                        
                        // Use original resolution dimensions for the final display
                        const drawW = imgW * imgScale;
                        const drawH = imgH * imgScale;
                        const imgX = centerX - drawW / 2;
                        const imgY = centerY - drawH / 2;
                        
                        // Draw image on temp canvas at original resolution
                        tempCtx.drawImage(appState.originalImage, imgX - stickerX, imgY - stickerY, drawW, drawH);
                        
                        if (outlineWidth > 0) {
                            // Generate Outline using distance transform algorithm for this sticker
                            const imageData = tempCtx.getImageData(0, 0, stickerSize, stickerSize);
                            const data = imageData.data;
                            
                            // Create a mask: 0 for empty, 1 for object
                            const distMap = new Float32Array(stickerSize * stickerSize);
                            const INF = 1e9;
                            
                            // Initialize Distance Map
                            for (let i = 0; i < stickerSize * stickerSize; i++) {
                                // Check alpha channel (every 4th byte)
                                if (data[i * 4 + 3] > 10) { // Threshold for "opaque"
                                    distMap[i] = 0;
                                } else {
                                    distMap[i] = INF;
                                }
                            }
                            
                            // Fast Euclidean Distance Transform (EDT) - Two-pass algorithm
                            // Pass 1: Top-Left to Bottom-Right
                            for (let y = 0; y < stickerSize; y++) {
                                for (let x = 0; x < stickerSize; x++) {
                                    const idx = y * stickerSize + x;
                                    if (distMap[idx] === 0) continue;
                                    
                                    let min = distMap[idx];
                                    // Check neighbors: Left, Top-Left, Top, Top-Right
                                    if (x > 0) min = Math.min(min, distMap[idx - 1] + 1); // Left
                                    if (y > 0) {
                                        min = Math.min(min, distMap[idx - stickerSize] + 1); // Top
                                        if (x > 0) min = Math.min(min, distMap[idx - stickerSize - 1] + 1.414); // Top-Left
                                        if (x < stickerSize - 1) min = Math.min(min, distMap[idx - stickerSize + 1] + 1.414); // Top-Right
                                    }
                                    distMap[idx] = min;
                                }
                            }
                            
                            // Pass 2: Bottom-Right to Top-Left
                            for (let y = stickerSize - 1; y >= 0; y--) {
                                for (let x = stickerSize - 1; x >= 0; x--) {
                                    const idx = y * stickerSize + x;
                                    if (distMap[idx] === 0) continue;
                                    
                                    let min = distMap[idx];
                                    // Check neighbors: Right, Bottom-Right, Bottom, Bottom-Left
                                    if (x < stickerSize - 1) min = Math.min(min, distMap[idx + 1] + 1); // Right
                                    if (y < stickerSize - 1) {
                                        min = Math.min(min, distMap[idx + stickerSize] + 1); // Bottom
                                        if (x < stickerSize - 1) min = Math.min(min, distMap[idx + stickerSize + 1] + 1.414); // Bottom-Right
                                        if (x > 0) min = Math.min(min, distMap[idx + stickerSize - 1] + 1.414); // Bottom-Left
                                    }
                                    distMap[idx] = min;
                                }
                            }
                            
                            // Draw the outline based on distance
                            const [r, g, b] = hexToRgb(outlineColor);
                            const resultData = ctx.createImageData(stickerSize, stickerSize);
                            const res = resultData.data;
                            
                            for (let i = 0; i < stickerSize * stickerSize; i++) {
                                const dist = distMap[i];
                                if (dist <= outlineWidth) {
                                    // Inside the outline zone
                                    let alpha = 255;
                                    if (smooth && dist > outlineWidth - 1) {
                                        // Fade out at the edge
                                        alpha = 255 * (1 - (dist - (outlineWidth - 1)));
                                    }
                                    
                                    res[i * 4] = r;
                                    res[i * 4 + 1] = g;
                                    res[i * 4 + 2] = b;
                                    res[i * 4 + 3] = alpha;
                                }
                            }
                            
                            // Put the outline on the main canvas
                            ctx.putImageData(resultData, stickerX, stickerY);
                        }
                        
                        // Reset shadow and draw the image on top at original resolution
                        ctx.shadowColor = 'transparent';
                        ctx.drawImage(appState.originalImage, imgX, imgY, drawW, drawH);
                        
                        // Circle border removed - stickers now have clean edges
                    }
                }
                
                // Update the total stickers display
                totalStickersValue.textContent = cols * rows;
            }
            
            // Canvas sizing function with original resolution support
            function updateCanvasSizeForOriginalResolution() {
                const cols = appState.grid.horizontal;
                const rows = appState.grid.vertical;
                
                // Base sticker size adjusted for original resolution display
                const baseStickerSize = 120; // Increased from 60 to show more detail
                const gap = 15; // pixels between stickers
                const padding = 30; // padding around the grid
                
                // Calculate total dimensions
                const totalWidth = cols * baseStickerSize + (cols - 1) * gap + padding * 2;
                const totalHeight = rows * baseStickerSize + (rows - 1) * gap + padding * 2;
                
                // Set canvas size
                canvas.width = totalWidth;
                canvas.height = totalHeight;
                
                // Update container sizes to fit content
                previewBoard.style.width = totalWidth + 'px';
                previewBoard.style.height = totalHeight + 'px';
                canvasContainer.style.width = totalWidth + 'px';
                canvasContainer.style.height = totalHeight + 'px';
                
                // Add smooth transition
                previewBoard.style.transition = 'width 0.3s ease, height 0.3s ease';
                canvasContainer.style.transition = 'width 0.3s ease, height 0.3s ease';
            }
            
            // Generate sticker sheet for download with original resolution support
            function generateStickerSheet() {
                try {
                    showNotification('Generating Sticker Sheet', 'Creating high-quality transparent sticker sheet with original resolution', 'info');
                    
                    // Create high-resolution canvas using original resolution drawing
                    const sheetCanvas = document.createElement('canvas');
                    const sheetCtx = sheetCanvas.getContext('2d');
                    
                    // Calculate dimensions for high-resolution output
                    const cols = appState.grid.horizontal;
                    const rows = appState.grid.vertical;
                    const outlineWidth = appState.outlineEnabled ? appState.outline.width : 0;
                    const outlineColor = appState.outline.color;
                    const smooth = appState.outline.smoothing;
                    
                    // High resolution base dimensions (6x scale for print quality)
                    const baseStickerSize = 120 * 6; // 720px per sticker at 300 DPI
                    const gap = 15 * 6; // 90px gap
                    const padding = 30 * 6; // 180px padding
                    
                    // Calculate total dimensions
                    const totalWidth = cols * baseStickerSize + (cols - 1) * gap + padding * 2;
                    const totalHeight = rows * baseStickerSize + (rows - 1) * gap + padding * 2;
                    
                    // Set canvas size for original resolution output
                    sheetCanvas.width = totalWidth;
                    sheetCanvas.height = totalHeight;
                    
                    // Set high-quality scaling
                    sheetCtx.imageSmoothingEnabled = true;
                    sheetCtx.imageSmoothingQuality = 'high';
                    
                    // DO NOT fill background - keep it transparent for clean sticker sheets
                    // sheetCtx.fillStyle = 'transparent';
                    // sheetCtx.fillRect(0, 0, totalWidth, totalHeight);
                    
                    // Calculate sticker size based on available space
                    const availableWidth = totalWidth - (padding * 2);
                    const availableHeight = totalHeight - (padding * 2);
                    const stickerSize = Math.min(
                        (availableWidth - (cols - 1) * gap) / cols,
                        (availableHeight - (rows - 1) * gap) / rows
                    );
                    
                    // Calculate starting position to center the grid
                    const startX = (totalWidth - (cols * stickerSize + (cols - 1) * gap)) / 2;
                    const startY = (totalHeight - (rows * stickerSize + (rows - 1) * gap)) / 2;
                    
                    // Draw each sticker in the grid with original resolution
                    for (let row = 0; row < rows; row++) {
                        for (let col = 0; col < cols; col++) {
                            const stickerX = startX + col * (stickerSize + gap);
                            const stickerY = startY + row * (stickerSize + gap);
                            const centerX = stickerX + stickerSize / 2;
                            const centerY = stickerY + stickerSize / 2;
                            
                            // Create temporary canvas for this sticker at original resolution
                            const tempCanvas = document.createElement('canvas');
                            tempCanvas.width = stickerSize;
                            tempCanvas.height = stickerSize;
                            const tempCtx = tempCanvas.getContext('2d');
                            
                            // Clear temp canvas (transparent)
                            tempCtx.clearRect(0, 0, stickerSize, stickerSize);
                            
                            // Draw sticker background circle with transparent center
                            sheetCtx.beginPath();
                            sheetCtx.arc(centerX, centerY, stickerSize / 2, 0, 2 * Math.PI);
                            sheetCtx.fillStyle = '#ffffff';
                            sheetCtx.fill();
                            
                            // Add subtle shadow for depth
                            sheetCtx.shadowColor = 'rgba(0, 0, 0, 0.1)';
                            sheetCtx.shadowBlur = 4 * 6; // Scale shadow for high resolution
                            sheetCtx.shadowOffsetX = 2 * 6;
                            sheetCtx.shadowOffsetY = 2 * 6;
                            
                            // Calculate image size for ORIGINAL RESOLUTION
                            const imgW = appState.originalImage.width;
                            const imgH = appState.originalImage.height;
                            
                            // Use original resolution with appropriate scaling for print
                            const maxImgSize = stickerSize * 0.8; // Use 80% of sticker size
                            const imgScale = Math.min(maxImgSize / imgW, maxImgSize / imgH);
                            
                            // Apply original resolution with proper scaling
                            const drawW = imgW * imgScale;
                            const drawH = imgH * imgScale;
                            const imgX = centerX - drawW / 2;
                            const imgY = centerY - drawH / 2;
                            
                            // Draw image on temp canvas at original resolution
                            tempCtx.drawImage(appState.originalImage, imgX - stickerX, imgY - stickerY, drawW, drawH);
                            
                            if (outlineWidth > 0) {
                                // Generate Outline using distance transform algorithm for this sticker
                                const imageData = tempCtx.getImageData(0, 0, stickerSize, stickerSize);
                                const data = imageData.data;
                                
                                // Create a mask: 0 for empty, 1 for object
                                const distMap = new Float32Array(stickerSize * stickerSize);
                                const INF = 1e9;
                                
                                // Initialize Distance Map
                                for (let i = 0; i < stickerSize * stickerSize; i++) {
                                    // Check alpha channel (every 4th byte)
                                    if (data[i * 4 + 3] > 10) { // Threshold for "opaque"
                                        distMap[i] = 0;
                                    } else {
                                        distMap[i] = INF;
                                    }
                                }
                                
                                // Fast Euclidean Distance Transform (EDT) - Two-pass algorithm
                                // Pass 1: Top-Left to Bottom-Right
                                for (let y = 0; y < stickerSize; y++) {
                                    for (let x = 0; x < stickerSize; x++) {
                                        const idx = y * stickerSize + x;
                                        if (distMap[idx] === 0) continue;
                                        
                                        let min = distMap[idx];
                                        // Check neighbors: Left, Top-Left, Top, Top-Right
                                        if (x > 0) min = Math.min(min, distMap[idx - 1] + 1); // Left
                                        if (y > 0) {
                                            min = Math.min(min, distMap[idx - stickerSize] + 1); // Top
                                            if (x > 0) min = Math.min(min, distMap[idx - stickerSize - 1] + 1.414); // Top-Left
                                            if (x < stickerSize - 1) min = Math.min(min, distMap[idx - stickerSize + 1] + 1.414); // Top-Right
                                        }
                                        distMap[idx] = min;
                                    }
                                }
                                
                                // Pass 2: Bottom-Right to Top-Left
                                for (let y = stickerSize - 1; y >= 0; y--) {
                                    for (let x = stickerSize - 1; x >= 0; x--) {
                                        const idx = y * stickerSize + x;
                                        if (distMap[idx] === 0) continue;
                                        
                                        let min = distMap[idx];
                                        // Check neighbors: Right, Bottom-Right, Bottom, Bottom-Left
                                        if (x < stickerSize - 1) min = Math.min(min, distMap[idx + 1] + 1); // Right
                                        if (y < stickerSize - 1) {
                                            min = Math.min(min, distMap[idx + stickerSize] + 1); // Bottom
                                            if (x < stickerSize - 1) min = Math.min(min, distMap[idx + stickerSize + 1] + 1.414); // Bottom-Right
                                            if (x > 0) min = Math.min(min, distMap[idx + stickerSize - 1] + 1.414); // Bottom-Left
                                        }
                                        distMap[idx] = min;
                                    }
                                }
                                
                                // Draw the outline based on distance
                                const [r, g, b] = hexToRgb(outlineColor);
                                const resultData = sheetCtx.createImageData(stickerSize, stickerSize);
                                const res = resultData.data;
                                
                                for (let i = 0; i < stickerSize * stickerSize; i++) {
                                    const dist = distMap[i];
                                    if (dist <= outlineWidth * 6) { // Scale outline width for high resolution
                                        // Inside the outline zone
                                        let alpha = 255;
                                        if (smooth && dist > (outlineWidth * 6) - 1) {
                                            // Fade out at the edge
                                            alpha = 255 * (1 - (dist - ((outlineWidth * 6) - 1)));
                                        }
                                        
                                        res[i * 4] = r;
                                        res[i * 4 + 1] = g;
                                        res[i * 4 + 2] = b;
                                        res[i * 4 + 3] = alpha;
                                    }
                                }
                                
                                // Put the outline on the main canvas
                                sheetCtx.putImageData(resultData, stickerX, stickerY);
                            }
                            
                            // Reset shadow and draw the image on top at original resolution
                            sheetCtx.shadowColor = 'transparent';
                            sheetCtx.drawImage(appState.originalImage, imgX, imgY, drawW, drawH);
                        }
                    }
                    
                    // Add subtle border only for reference (optional - can be removed for pure transparency)
                    // sheetCtx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
                    // sheetCtx.lineWidth = 1 * 6;
                    // sheetCtx.strokeRect(0, 0, totalWidth, totalHeight);
                    
                    // Add text information at the bottom (only if there's space)
                    // Only add text if the canvas is large enough
                    if (totalHeight > 100) {
                        sheetCtx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                        sheetCtx.font = `12px Inter, sans-serif`;
                        sheetCtx.textAlign = 'center';
                        const infoText = `Board: ${appState.boardSize.width}${appState.boardSize.height}cm | Stickers: ${cols}${rows} | Diameter: ${appState.stickerDiameter}cm | Original Resolution`;
                        sheetCtx.fillText(infoText, totalWidth / 2, totalHeight - 20);
                        
                        // Add branding
                        sheetCtx.fillStyle = 'rgba(37, 99, 235, 0.7)';
                        sheetCtx.font = `10px Inter, sans-serif`;
                        sheetCtx.textAlign = 'left';
                        sheetCtx.fillText('Premium Sticker Customizer', 20, totalHeight - 40);
                    }
                    
                    // Convert canvas to blob and download
                    sheetCanvas.toBlob(function(blob) {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `sticker-sheet-transparent-original-resolution-${appState.boardSize.width}x${appState.boardSize.height}cm-${cols}x${rows}.png`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        setTimeout(() => {
                            showNotification('Download Complete', 'Your transparent original resolution sticker sheet has been downloaded', 'success');
                        }, 500);
                    }, 'image/png', 1.0);
                    
                } catch (error) {
                    console.error('Download error:', error);
                    showNotification('Download Failed', 'There was an error generating your sticker sheet', 'error');
                }
            }
            
            // Convert hex color to RGB
            function hexToRgb(hex) {
                const bigint = parseInt(hex.slice(1), 16);
                const r = (bigint >> 16) & 255;
                const g = (bigint >> 8) & 255;
                const b = bigint & 255;
                return [r, g, b];
            }
            
            // Handle window resize
            window.addEventListener('resize', function() {
                // Debounce resize events
                clearTimeout(window.resizeTimer);
                window.resizeTimer = setTimeout(function() {
                    // Adjust canvas size if needed
                    draw();
                }, 250);
            });
            
            // Initialize the app
            initApp();
        });
    </script>
</body>
</html>